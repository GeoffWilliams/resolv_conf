<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: resolv_conf
  
    &mdash; Documentation by YARD 0.9.15
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::resolv_conf";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (r)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">resolv_conf</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: resolv_conf</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Resolve_conf</p>

<p>Manage the /etc/resolv.conf file.</p>

<p>Rather then using a template, the file is edited in-place. This eliminates
the need to maintain a template and means that only the items we are
interested in managing are managed. This makes it possible to use this
module to say set the search domain without necessarily setting the
nameservers, which would be impossible if we insisted on managing the whole
file.</p>

<p>Previous versions of this module would automatically setup google DNS. This
is no longer the case.</p>

  </div>
</div>


<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>basic usage</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_resolv_conf'>resolv_conf</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data to set the nameservers</p>
</div></p>
      
      <pre class="example code"><code>resolve_conf::nameservers:
  - &quot;8.8.8.8&quot;
  - &quot;8.8.4.4&quot;</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data to set options</p>
</div></p>
      
      <pre class="example code"><code>resolv_conf::options:
  - &quot;rotate&quot;
  - &quot;timeout:2&quot;
  - &quot;attempts:2&quot;</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data to set the search domain</p>
</div></p>
      
      <pre class="example code"><code>resolv_conf::search: &quot;megacorp.com&quot;</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>search_keyword</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Keyword prefix for search domains</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>search</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Search domain</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Optional[Array[String]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Array of options</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>nameservers</span>
      
      
        <span class='type'>(<tt>Optional[Array[String]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Array of nameservers</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>resolv_conf_path</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;/etc/resolv.conf&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path to /etc/resolve.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>resolv_conf_owner</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;root&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Owner for /etc/resolv.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>resolv_conf_group</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Group for /etc/resolv.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>resolv_conf_mode</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;0644&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Mode for /etc/resolv.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>header</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;# managed by puppet&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Header to insert into /etc/resolv.conf</p>
</div>
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 40</span>

class resolv_conf(
    Optional[String]        $search_keyword,
    Optional[String]        $search             = &quot;&quot;,
    Optional[Array[String]] $options            = [],
    Optional[Array[String]] $nameservers        = [],
    String                  $resolv_conf_path   = &quot;/etc/resolv.conf&quot;,
    String                  $resolv_conf_owner  = &quot;root&quot;,
    Integer                 $resolv_conf_group  = 0,
    String                  $resolv_conf_mode   = &quot;0644&quot;,
    String                  $header             = &quot;# managed by puppet&quot;,
) {

  # work out what lines should be in the file
  $search_line = &quot;${search_keyword} ${search}&quot;
  $nameservers_lines = $nameservers.map |$l| {
    &quot;nameserver ${l}&quot;
  }.join(&quot;\n&quot;)
  $options_lines = $options.map |$l| {
    &quot;option ${l}&quot;
  }.join(&quot;\n&quot;)

  file { $resolv_conf_path:
    ensure =&gt; file,
    owner  =&gt; $resolv_conf_owner,
    group  =&gt; $resolv_conf_group,
    mode   =&gt; $resolv_conf_mode,
  }

  fm_prepend { $resolv_conf_path:
    ensure =&gt; present,
    data   =&gt; $header,
  }

  fm_replace { &quot;${resolv_conf_path} search line&quot;:
    ensure            =&gt; present,
    path              =&gt; $resolv_conf_path,
    data              =&gt; $search_line,
    match             =&gt; &quot;^${search_keyword}&quot;,
    insert_if_missing =&gt; true,
    insert_at         =&gt; &quot;top&quot;,
  }

  fm_replace { &quot;${resolv_conf_path} nameservers lines&quot;:
    ensure            =&gt; present,
    path              =&gt; $resolv_conf_path,
    data              =&gt; $nameservers_lines,
    match             =&gt; &quot;^nameserver &quot;,
    insert_if_missing =&gt; true,
    insert_at         =&gt; &quot;bottom&quot;,
  }

  fm_replace { &quot;${resolv_conf_path} options lines&quot;:
    ensure            =&gt; present,
    path              =&gt; $resolv_conf_path,
    data              =&gt; $options_lines,
    match             =&gt; &quot;^option &quot;,
    insert_if_missing =&gt; true,
    insert_at         =&gt; &quot;bottom&quot;,
  }

  # On Solaris must also bounce the dns client service
  if $facts[&#39;os&#39;][&#39;family&#39;] == &quot;Solaris&quot; {
    Service { &quot;dns/client&quot;:
      ensure    =&gt; running,
      enable    =&gt; true,
      subscribe =&gt; File[$resolv_conf_path],
    }
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>